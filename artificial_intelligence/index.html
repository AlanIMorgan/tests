<!DOCTYPE html>
<html lang="es">

    <head>

        <meta charset="UTF-8">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="color-scheme" content="dark">

        <script src="artificial_intelligence/browser.js"></script>

        <title> Inteligencia Artificial </title>

        <style>

            *{
                font-family: "Segoe UI", "Roboto", arial, sans-serif;
                font-size: 20px;
                line-height: 1.25;
                padding: 0;
                margin: 0;
                border: none;
                box-sizing: border-box;
                color: #ddd;
                outline: none;
                user-select: none;
                -webkit-user-drag: none;
            }

            html{
                height: 100%;
                overflow: hidden;
                background: #505967;
            }

            body{
                text-align: center;
            }

            h1{
                font-size: 2em;
                margin-bottom: 100px;
                color: #baf;
                filter: drop-shadow(0px 0px 2px #000) drop-shadow(0px 0px 4px #baf);
            }

            h2{
                font-size: 1.5em;
                margin-bottom: 10px;
                font-style: italic;
            }

            p{
                margin-bottom: 5px;
            }

            input[type="color"]{
                margin: 20px;
                outline: 4px solid #beb;
                border-radius: 2px;
                filter: drop-shadow(0px 0px 1px #000) drop-shadow(0px 0px 4px #beb);
            }

            .range_container{
                position: relative;
                display: flex;
                justify-content: center;
                align-items: center;
                width: 100%;
                height: 25px;
            }

            .range_container span{
                position: absolute;
                z-index: 9;
                display: inline-block;
                width: 100%;
                height: 100%;
            }

            input[type="range"]{
                display: none;
                width: 25%;
            }
        </style>
    </head>

    <body>

        <h1> Aprendizaje profundo <br> (con brain.js) </h1>

        <h2> Selecciona un color: </h2>

        <input type="color" id="colorSelector">

        <div id="demo">

            <div class="range_container">

                <span></span>

                <input type="range" id="dark_bar">
            </div>

            <div class="range_container">

                <span></span>

                <input type="range" id="light_bar">
            </div>
        </div>

        <script>

            // Se declara una constante para conservar el elemento donde aparecerá la información

            const demo = document.getElementById("demo");

            // Se declaran constantes para conservar las barras donde se mostrarán los resultados

            darkBar = document.getElementById("dark_bar");

            lightBar = document.getElementById("light_bar");

            // Se construye una red neuronal para detectar el brillo

            const brightnessNN = new brain.NeuralNetwork();

            // Se construye una red neuronal para detectar colores

            const colorNN = new brain.NeuralNetwork();

            // Se entrenan las redes con algunos objetos de entrada

            brightnessNN.train( [

                // Blanco RGB(255, 255, 255)

                { input:[255/255, 255/255, 255/255], output:{light:1} },

                // Gris claro (192,192,192)

                { input:[192/255, 192/255, 192/255], output:{light:1} },

                // Gris oscuro (64, 64, 64)

                { input:[65/255, 65/255, 65/255], output:{dark:1} },

                // Negro (0, 0, 0)

                { input:[0, 0, 0], output:{dark:1} }
            ],
            {log: true} );

            colorNN.train( [

                // Rojo RGB(255, 0, 0)

                { input:[255/255, 0, 0], output:{red:1} },

                // Rojo RGB(255, 119, 119)

                { input:[255/255, 119/255, 119/255], output:{red:1} },

                // Verde RGB(0, 255, 0)

                { input:[0, 255/255, 0], output:{green:1} },

                // Verde RGB(119, 255, 119)

                { input:[119/255, 255/255, 119/255], output:{green:1} },

                // Azul RGB(0, 0, 255)

                { input:[0, 0, 255/255], output:{blue:1} },

                // Azul RGB(119, 119, 255)

                { input:[119/255, 119/255, 255/255], output:{blue:1} }
            ],
            {log: true} );

            // Se declara una función para convertir el formato de color hexadecimal en RGB

            const hexToRGB = (hex) => {

                const r = parseInt(hex.slice(1, 3), 16);

                const g = parseInt(hex.slice(3, 5), 16);

                const b = parseInt(hex.slice(5, 7), 16);

                return [r, g, b];
            }

            // Se declara una variable para conservar el código del color que se analizará

            input = '#' + "bbbbbb";

            // Se convierte el valor ingresado

            color = hexToRGB(input);

            // Se entrega el color a la IA de brillo para saber si hay diferencia de colores base

            brightnessResult = brightnessNN.run([color[0] / 255, color[1] / 255, color[2] / 255]);

            // Se muestran las barras con los resultados

            lightBar.value = brightnessResult["light"];

            darkBar.value = brightnessResult["dark"];

            lightBar.style.display = "inline-block"

            darkBar.style.display = "inline-block"

            // Se divide el resultado entre brillo y oscuridad para saber cuál es mayor

            darker = brightnessResult["dark"] / brightnessResult["light"];

            lighter = brightnessResult["light"] / brightnessResult["dark"];

            // Se crea la variable colorResult para usarla más tarde

            colorResult = [];

            // Si la claridad es mayor o igual a 9...

            if (lighter >= 9) {

                // ... El brillo (y, por lo tanto, el color) es completamente blanco

                colorName = "White";
            } else

            // Si no, si la oscuridad es mayor a 9...

            if (darker >= 9) {

                // ... El brillo (y, por lo tanto, el color) es completamente oscuro

                colorName = "Black";
            } else {

                // Si no, se entrega el color a la IA de colores y se conserva el resultado

                colorResult = colorNN.run([color[0] / 255, color[1] / 255, color[2] / 255])

                // Se divide el resultado en colores y se conservan los valores

                redResult = colorResult["red"];

                greenResult = colorResult["green"];

                blueResult = colorResult["blue"];

                // Si la oscuridad es mayor a 0.85 y la claridad también...

                if (redResult > 0.19 && redResult < 0.31 && greenResult > 0.19 && greenResult < 0.31 && blueResult > 0.19 && blueResult < 0.31) {

                    // ... Entonces, el brillo (y, por lo tanto, el color) es gris

                    colorName = "Grey"
                } else {

                    // ... Si no, se categoriza el color con los valores

                    // Se muestran los valores de los colores

                    demo.innerHTML += "<p> Rojo: " + redResult + "<br>" + "Verde: " + greenResult + "<br>" + "Azul: " + blueResult + "</p>";
                }
            }

            // demo.innerHTML += "Nombre del color: " + colorName;
        </script>
    </body>
</html>